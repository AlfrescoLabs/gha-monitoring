package org.alfresco.badges.service.impl;

import io.github.dsibilio.badgemaker.core.BadgeFormatBuilder;
import io.github.dsibilio.badgemaker.core.BadgeMaker;
import io.github.dsibilio.badgemaker.model.BadgeFormat;
import io.github.dsibilio.badgemaker.model.NamedColor;
import java.io.IOException;
import java.util.Optional;
import java.util.function.Function;
import org.alfresco.badges.model.GHIssueState;
import org.alfresco.badges.model.GithubPullRequest;
import org.alfresco.badges.model.PullRequestStatus;
import org.alfresco.badges.models.PullRequestSimple;
import org.alfresco.badges.models.WorkflowRun;
import org.alfresco.badges.service.api.PullRequestService;
import org.alfresco.badges.web.client.api.GitHubWebClient;
import org.alfresco.badges.web.server.model.PrField;
import org.springframework.stereotype.Service;
import reactor.core.publisher.Flux;
import reactor.core.publisher.Mono;

@Service
public class PullRequestServiceImpl implements PullRequestService {

  private final GitHubWebClient gitHubWebClient;
  private static final String BADGE_LOGO = "data:image/png;base64,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AAESANoABCAAAQhAIEECJAAJVjohQwACEIAABEgAaAMQgAAEIACBBAmQACRY6YQMAQhAAAIQIAGgDUAAAhCAAAQSJEACkGClEzIEIAABCECABIA2AAEIQAACEEiQAAlAgpVOyBCAAAQgAAESANoABCAAAQhAIEECJAAJVjohQwACEIAABEgAaAMQgAAEIACBBAmQACRY6YQMAQhAAAIQIAGgDUAAAhCAAAQSJEACkGClEzIEIAABCECABIA2AAEIQAACEEiQAAlAgpVOyBCAAAQgAAESANoABCAAAQhAIEECJAAJVjohQwACEIAABEgAaAMQgAAEIACBBAmQACRY6YQMAQhAAAIQIAGgDUAAAhCAAAQSJEACkGClEzIEIAABCECABIA2AAEIQAACEEiQAAlAgpVOyBCAAAQgAAESANoABCAAAQhAIEECJAAJVjohQwACEIAABEgAaAMQgAAEIACBBAmQACRY6YQMAQhAAAIQIAGgDUAAAhCAAAQSJEACkGClEzIEIAABCECABIA2AAEIQAACEEiQAAlAgpVOyBCAAAQgAAESANoABCAAAQhAIEECJAAJVjohQwACEIAABEgAaAMQgAAEIACBBAmQACRY6YQMAQhAAAIQIAGgDUAAAhCAAAQSJEACkGClEzIEIAABCECABIA2AAEIQAACEEiQAAlAgpVOyBCAAAQgAAESANoABCAAAQhAIEECJAAJVjohQwACEIAABEgAaAMQgAAEIACBBAmQACRY6YQMAQhAAAIQIAGgDUAAAhCAAAQSJEACkGClEzIEIAABCECABIA2AAEIQAACEEiQAAlAgpVOyBCAAAQgAAESANoABCAAAQhAIEECJAAJVjohQwACEIAABEgAaAMQgAAEIACBBAmQACRY6YQMAQhAAAIQIAGgDUAAAhCAAAQSJEACkGClEzIEIAABCECABIA2AAEIQAACEEiQAAlAgpVOyBCAAAQgAAESANoABCAAAQhAIEECJAAJVjohQwACEIAABEgAaAMQgAAEIACBBAmQACRY6YQMAQhAAAIQIAGgDUAAAhCAAAQSJEACkGClEzIEIAABCECABIA2AAEIQAACEEiQAAlAgpVOyBCAAAQgAAESANoABCAAAQhAIEECJAAJVjohQwACEIAABEgAaAMQgAAEIACBBAmQACRY6YQMAQhAAAIQIAGgDUAA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";
  private static final Optional<GithubPullRequest> EMPTY = Optional.of(GithubPullRequest.emptyRequest());

  public PullRequestServiceImpl(GitHubWebClient gitHubWebClient) {
    this.gitHubWebClient = gitHubWebClient;
  }


  @Override
  public Mono<String> getPullRequestStatus(String owner, String repository, String pattern,
      String user, PrField field) {
    return getPullRequestStatus(owner, repository, user, pattern)
         .map(this::buildBadge);
  }

  private String buildBadge(GithubPullRequest githubPullRequest) {
    String message = Optional.ofNullable(githubPullRequest.getDescription()).orElse(githubPullRequest.getName());
    BadgeFormat badgeFormat = new BadgeFormatBuilder(message)
        .withLabelColor(NamedColor.GREY)
        .withMessageColor(githubPullRequest.getPullRequestStatus().getColor())
        .withLogo(BADGE_LOGO)
        .build();

    return BadgeMaker.makeBadge(badgeFormat);
  }

  public Mono<GithubPullRequest> getPullRequestStatus(String owner,String repository, String user, String filter)  {

    return getLastPullRequestToProcess(owner, repository, user, filter)
        .map(processDataAndBuildResponse(owner,repository))
        .singleOrEmpty(); //TODO was findFirst

  }

  private Function<PullRequestSimple, GithubPullRequest> processDataAndBuildResponse(String owner, String repository) {
    return pr -> {
      GithubPullRequest githubPullRequest = new GithubPullRequest();
      githubPullRequest.setTitle(pr.getTitle());
      githubPullRequest.setDescription(pr.getBody());
      githubPullRequest.setURL(pr.getHtml_url().toString());
      githubPullRequest.setMerged(pr.getMerged_at() != null);
      String branch = pr.getHead().getRef();
      Mono<Optional<WorkflowRun>> lastRunsFailedByPrNumber = getLastRunsByPrBranch(owner,repository, branch);
      githubPullRequest.setPullRequestStatus(PullRequestStatus.UNKNOWN);
      lastRunsFailedByPrNumber
              .subscribe(wr ->
                  wr.ifPresentOrElse(
                      ghWorkflowRun -> computeStatus(githubPullRequest, ghWorkflowRun, pr),
                      () -> githubPullRequest.setPullRequestStatus(PullRequestStatus.UNKNOWN))
              );
      return githubPullRequest;
    };
  }

  private Mono<Optional<WorkflowRun>> getLastRunsByPrBranch(String owner, String repository, String branch) {
    return gitHubWebClient.getWorkflowRunsForARepository(owner,repository,branch)
        .map(wr -> wr.getWorkflow_runs().stream().findFirst())
        .single(); //
  }

  private Flux<PullRequestSimple> getLastPullRequestToProcess(String owner,String repository, String user, String filter)  {
    return
      gitHubWebClient.getPullRequests(owner, repository, user,
            GHIssueState.OPEN.value())
        .switchIfEmpty(gitHubWebClient.getPullRequests(owner, repository, user,
            GHIssueState.CLOSED.value()))
        .filter(pr -> pr.getTitle().startsWith(filter));
  }

  private void computeStatus(GithubPullRequest githubPullRequest, WorkflowRun ghWorkflowRun, PullRequestSimple pr) {
    if (isClosedWithoutMerging(pr)) {
      githubPullRequest.setPullRequestStatus(PullRequestStatus.MERGED);
    } else if (isMergedEvenIfItIsFailed(githubPullRequest, ghWorkflowRun)) {
      githubPullRequest.setPullRequestStatus(PullRequestStatus.MERGED);
    } else if (isFailedAndCompleted(ghWorkflowRun)) {
      githubPullRequest.setPullRequestStatus(PullRequestStatus.FAILED);
    } else if (ghWorkflowRun.getStatus().equals("in_progress")) {
      githubPullRequest.setPullRequestStatus(PullRequestStatus.RUNNING);
    } else if (ghWorkflowRun.getStatus().equals("completed") && ghWorkflowRun.getConclusion().equals("cancelled")) {
      githubPullRequest.setPullRequestStatus(PullRequestStatus.CANCELLED);
    } else {
      githubPullRequest.setPullRequestStatus(PullRequestStatus.SUCCESS);
    }
  }

  private boolean isFailedAndCompleted(WorkflowRun ghWorkflowRun) {
    return ghWorkflowRun.getStatus().equals("completed") && ghWorkflowRun.getConclusion().equals("failure");
  }

  private boolean isMergedEvenIfItIsFailed(GithubPullRequest githubPullRequest, WorkflowRun ghWorkflowRun) {
    return ghWorkflowRun.getStatus().equals("completed") && ghWorkflowRun.getConclusion().equals("failure") && githubPullRequest.getMerged();
  }

  private boolean isClosedWithoutMerging(PullRequestSimple pr) {
      return pr.getMerged_at()==null && pr.getState().equals(GHIssueState.CLOSED);
  }

}
